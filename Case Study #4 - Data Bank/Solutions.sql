
--- A. Customer Nodes Exploration
-- How many unique nodes are there on the Data Bank system?
--**Schema (PostgreSQL v13)**

SELECT 
  COUNT(DISTINCT node_id) AS distinct_nodes 
FROM data_bank.customer_nodes;

-- Output 
--| distinct_nodes |
--| -------------- |
--| 5              |


-- What is the number of nodes per region?
-- The question does not specify if they need unique nodes. However, if we are interested in the number of nodes per region, then unique makes sense. 
-- Else, they would have just asked for number of customers per region

-- **Schema (PostgreSQL v13)**

SELECT 
  region_id
  , COUNT( DISTINCT node_id) AS nodes_no
FROM data_bank.customer_nodes
GROUP BY region_id;

-- Output 
--| region_id | nodes_no |
--| --------- | -------- |
--| 1         | 5        |
--| 2         | 5        |
--| 3         | 5        |
--| 4         | 5        |
--| 5         | 5        |


-- How many customers are allocated to each region?

SELECT 
  region_id
  , COUNT( DISTINCT customer_id) AS "#customer"
FROM data_bank.customer_nodes
GROUP BY region_id;

-- Output 
--| region_id | #customer |
--| --------- | --------- |
--| 1         | 110       |
--| 2         | 105       |
--| 3         | 102       |
--| 4         | 95        |
--| 5         | 88        |


-- How many days on average are customers reallocated to a different node?

SELECT 
  ROUND(AVG(end_date- start_date),2) AS avg_days
FROM data_bank.customer_nodes
WHERE end_date!=CAST('9999-12-31' AS date);

-- Output
--| avg_days |
--| -------- |
--| 14.63    |


--What is the median, 80th and 95th percentile for this same reallocation days metric for each region?

WITH days_cte AS (
  SELECT 
    ROUND((end_date- start_date),2) AS days_diff
  FROM data_bank.customer_nodes
  WHERE end_date!=CAST('9999-12-31' AS date)
    )
    
SELECT 
  PERCENTILE_CONT(0.50) WITHIN GROUP (ORDER BY days_diff ASC) AS percentile_50
  , PERCENTILE_CONT(0.80) WITHIN GROUP (ORDER BY days_diff ASC) AS percentile_80
  , PERCENTILE_CONT(0.95) WITHIN GROUP (ORDER BY days_diff ASC) AS percentile_95
FROM days_cte;
    
-- Output

--| percentile_50 | percentile_80 | percentile_95 |
--| ------------- | ------------- | ------------- |
--| 15            | 23            | 28            |



-- B. Customer Transactions
-- What is the unique count and total amount for each transaction type?

SELECT 
  txn_type
  , COUNT(customer_id) AS unique_txn
  , SUM(txn_amount) AS total_amount
FROM (
  SELECT DISTINCT 
    customer_id
    , txn_date
    , txn_type
    , txn_amount
  FROM data_bank.customer_transactions
      )a
GROUP BY txn_type;
      
      
-- Output
--| txn_type   | unique_txn | total_amount |
--| ---------- | ---------- | ------------ |
--| purchase   | 1617       | 806537       |
--| deposit    | 2671       | 1359168      |
--| withdrawal | 1580       | 793003       |


-- What is the average total historical deposit counts and amounts for all customers?

SELECT 
  COUNT(customer_id) AS unique_txn
  , SUM(txn_amount) AS total_amount
FROM (
  SELECT DISTINCT 
        customer_id
        , txn_date
        , txn_type
        , txn_amount
      	, RANK() OVER (ORDER BY txn_date DESC) AS txn_date_rank
  FROM data_bank.customer_transactions
       )a
WHERE txn_date_rank>1;

--Output
--| unique_txn | total_amount |
--| ---------- | ------------ |
--| 5865       | 2956643      |



--For each month - how many Data Bank customers make more than 1 deposit and either 1 purchase or 1 withdrawal in a single month?

SELECT 
  txn_month
  , COUNT(DISTINCT customer_id) AS "customers#"
FROM(	
  SELECT  
    EXTRACT(MONTH FROM txn_date) AS txn_month
    , customer_id
    , SUM(CASE WHEN txn_type = 'deposit' THEN 1 ELSE 0 END) OVER (PARTITION BY customer_id) AS 	"deposit#"
    , SUM(CASE WHEN txn_type = 'purchase' THEN 1 ELSE 0 END) OVER (PARTITION BY customer_id) AS "purchase#"
    , SUM(CASE WHEN txn_type = 'withdrawal' THEN 1 ELSE 0 END) OVER (PARTITION BY customer_id) AS "withdrawal#"
  FROM data_bank.customer_transactions
  GROUP BY EXTRACT(MONTH FROM txn_date), customer_id, txn_type
  )a
WHERE "deposit#">1 AND (("purchase#"=1 OR "withdrawal#"=1) AND ("purchase#"+"withdrawal#"=1))
GROUP BY txn_month;

-- Output
--| txn_month | customers# |
--| --------- | ---------- |
--| 1         | 37         |
--| 2         | 24         |
--| 3         | 26         |
--| 4         | 16         |



-- What is the closing balance for each customer at the end of the month?



SELECT 
	txn_month
    , customer_id
    , SUM(balance) OVER (PARTITION BY customer_id ORDER BY txn_month) AS closing_balance
FROM(
	SELECT  
		EXTRACT(MONTH FROM txn_date) AS txn_month
        , customer_id
        , SUM(CASE WHEN txn_type = 'deposit' THEN txn_amount ELSE 0 END) - SUM(CASE WHEN txn_type = 'purchase' THEN txn_amount ELSE 0 END) - SUM(CASE WHEN txn_type = 'withdrawal' THEN txn_amount ELSE 0 END) AS "balance"
    FROM data_bank.customer_transactions
    GROUP BY EXTRACT(MONTH FROM txn_date), customer_id
    )b
GROUP BY txn_month, customer_id, balance;

/*
Output

| txn_month | customer_id | closing_balance |
| --------- | ----------- | --------------- |
| 1         | 1           | 312             |
| 3         | 1           | -640            |
| 1         | 2           | 549             |
| 3         | 2           | 610             |
| 1         | 3           | 144             |
| 2         | 3           | -821            |
| 3         | 3           | -1222           |
| 4         | 3           | -729            |
| 1         | 4           | 848             |
| 3         | 4           | 655             |
| 1         | 5           | 954             |
| 3         | 5           | -1923           |
| 4         | 5           | -2413           |
| 1         | 6           | 733             |
| 2         | 6           | -52             |
| 3         | 6           | 340             |
| 1         | 7           | 964             |
| 2         | 7           | 3173            |
| 3         | 7           | 2533            |
| 4         | 7           | 2623            |
| 1         | 8           | 587             |
| 2         | 8           | 407             |
| 3         | 8           | -57             |
| 4         | 8           | -1029           |
| 1         | 9           | 849             |
| 2         | 9           | 654             |
| 3         | 9           | 1584            |
| 4         | 9           | 862             |
| 1         | 10          | -1622           |
| 2         | 10          | -1342           |
| 3         | 10          | -2753           |
| 4         | 10          | -5090           |
| 1         | 11          | -1744           |
| 2         | 11          | -2469           |
| 3         | 11          | -2088           |
| 4         | 11          | -2416           |
| 1         | 12          | 92              |
| 3         | 12          | 295             |
| 1         | 13          | 780             |
| 2         | 13          | 1279            |
| 3         | 13          | 1405            |
| 1         | 14          | 205             |
| 2         | 14          | 821             |
| 4         | 14          | 989             |
| 1         | 15          | 379             |
| 4         | 15          | 1102            |
| 1         | 16          | -1341           |
| 2         | 16          | -2893           |
| 3         | 16          | -4284           |
| 4         | 16          | -3422           |
| 1         | 17          | 465             |
| 2         | 17          | -892            |
| 1         | 18          | 757             |
| 2         | 18          | -424            |
| 3         | 18          | -842            |
| 4         | 18          | -815            |
| 1         | 19          | -12             |
| 2         | 19          | -251            |
| 3         | 19          | -301            |
| 4         | 19          | 42              |
| 1         | 20          | 465             |
| 2         | 20          | 519             |
| 3         | 20          | 776             |
| 1         | 21          | -204            |
| 2         | 21          | -764            |
| 3         | 21          | -1874           |
| 4         | 21          | -3253           |
| 1         | 22          | 235             |
| 2         | 22          | -1039           |
| 3         | 22          | -149            |
| 4         | 22          | -1358           |
| 1         | 23          | 94              |
| 2         | 23          | -314            |
| 3         | 23          | -156            |
| 4         | 23          | -678            |
| 1         | 24          | 615             |
| 2         | 24          | 813             |
| 3         | 24          | 254             |
| 1         | 25          | 174             |
| 2         | 25          | -400            |
| 3         | 25          | -1220           |
| 4         | 25          | -304            |
| 1         | 26          | 638             |
| 2         | 26          | -31             |
| 3         | 26          | -622            |
| 4         | 26          | -1870           |
| 1         | 27          | -1189           |
| 2         | 27          | -713            |
| 3         | 27          | -3116           |
| 1         | 28          | 451             |
| 2         | 28          | -818            |
| 3         | 28          | -1228           |
| 4         | 28          | 272             |
| 1         | 29          | -138            |
| 2         | 29          | -76             |
| 3         | 29          | 831             |
| 4         | 29          | -548            |
| 1         | 30          | 33              |
| 2         | 30          | -431            |
| 4         | 30          | 508             |
| 1         | 31          | 83              |
| 3         | 31          | -141            |
| 1         | 32          | -89             |
| 2         | 32          | 376             |
| 3         | 32          | -843            |
| 4         | 32          | -1001           |
| 1         | 33          | 473             |
| 2         | 33          | -116            |
| 3         | 33          | 1225            |
| 4         | 33          | 989             |
| 1         | 34          | 976             |
| 2         | 34          | -347            |
| 3         | 34          | -185            |
| 1         | 35          | 507             |
| 2         | 35          | -821            |
| 3         | 35          | -1163           |
| 1         | 36          | 149             |
| 2         | 36          | 290             |
| 3         | 36          | 1041            |
| 4         | 36          | 427             |
| 1         | 37          | 85              |
| 2         | 37          | 902             |
| 3         | 37          | -1069           |
| 4         | 37          | -959            |
| 1         | 38          | 367             |
| 2         | 38          | -465            |
| 3         | 38          | -798            |
| 4         | 38          | -1246           |
| 1         | 39          | 1429            |
| 2         | 39          | 2388            |
| 3         | 39          | 2460            |
| 4         | 39          | 2516            |
| 1         | 40          | 347             |
| 2         | 40          | 295             |
| 3         | 40          | 659             |
| 4         | 40          | -208            |
| 1         | 41          | -46             |
| 2         | 41          | 1379            |
| 3         | 41          | 3441            |
| 4         | 41          | 2525            |
| 1         | 42          | 447             |
| 2         | 42          | 1067            |
| 3         | 42          | -887            |
| 4         | 42          | -1886           |
| 1         | 43          | -201            |
| 2         | 43          | -406            |
| 3         | 43          | 869             |
| 4         | 43          | 545             |
| 1         | 44          | -690            |
| 2         | 44          | -19             |
| 4         | 44          | -339            |
| 1         | 45          | 940             |
| 2         | 45          | -1152           |
| 3         | 45          | 584             |
| 1         | 46          | 522             |
| 2         | 46          | 1388            |
| 3         | 46          | 80              |
| 4         | 46          | 104             |
| 1         | 47          | -1153           |
| 2         | 47          | -1283           |
| 3         | 47          | -2862           |
| 4         | 47          | -3169           |
| 1         | 48          | -2368           |
| 2         | 48          | -2972           |
| 3         | 48          | -3745           |
| 1         | 49          | -397            |
| 2         | 49          | -594            |
| 3         | 49          | -2556           |
| 1         | 50          | 931             |
| 2         | 50          | -674            |
| 3         | 50          | 275             |
| 4         | 50          | 450             |
| 1         | 51          | 301             |
| 2         | 51          | -97             |
| 3         | 51          | 779             |
| 4         | 51          | 1364            |
| 1         | 52          | 1140            |
| 2         | 52          | 2612            |
| 1         | 53          | 22              |
| 2         | 53          | 210             |
| 3         | 53          | -728            |
| 4         | 53          | 227             |
| 1         | 54          | 1658            |
| 2         | 54          | 1629            |
| 3         | 54          | 533             |
| 4         | 54          | 968             |
| 1         | 55          | 380             |
| 2         | 55          | -410            |
| 3         | 55          | 349             |
| 4         | 55          | -513            |
| 1         | 56          | -67             |
| 2         | 56          | -1646           |
| 3         | 56          | -2075           |
| 4         | 56          | -3866           |
| 1         | 57          | 414             |
| 2         | 57          | -101            |
| 3         | 57          | -866            |
| 1         | 58          | 383             |
| 2         | 58          | 1697            |
| 3         | 58          | -1196           |
| 4         | 58          | -635            |
| 1         | 59          | 924             |
| 2         | 59          | 2190            |
| 3         | 59          | 1652            |
| 4         | 59          | 798             |
| 1         | 60          | -189            |
| 2         | 60          | 668             |
| 3         | 60          | -745            |
| 4         | 60          | -1169           |
| 1         | 61          | 222             |
| 2         | 61          | 323             |
| 3         | 61          | -1710           |
| 4         | 61          | -2237           |
| 1         | 62          | -212            |
| 3         | 62          | -763            |
| 1         | 63          | -332            |
| 2         | 63          | -953            |
| 3         | 63          | -3946           |
| 1         | 64          | 2332            |
| 2         | 64          | 1554            |
| 3         | 64          | 245             |
| 1         | 65          | 25              |
| 3         | 65          | -450            |
| 4         | 65          | -1381           |
| 1         | 66          | 1971            |
| 2         | 66          | 1492            |
| 3         | 66          | -517            |
| 1         | 67          | 1593            |
| 2         | 67          | 2565            |
| 3         | 67          | 2050            |
| 4         | 67          | 1222            |
| 1         | 68          | 574             |
| 2         | 68          | 278             |
| 3         | 68          | -456            |
| 1         | 69          | 23              |
| 2         | 69          | -1944           |
| 3         | 69          | -2338           |
| 4         | 69          | -3085           |
| 1         | 70          | -584            |
| 2         | 70          | -63             |
| 3         | 70          | -1814           |
| 1         | 71          | 128             |
| 2         | 71          | -673            |
| 3         | 71          | -1265           |
| 1         | 72          | 796             |
| 2         | 72          | -803            |
| 3         | 72          | -1680           |
| 4         | 72          | -2327           |
| 1         | 73          | 513             |
| 1         | 74          | 229             |
| 3         | 74          | 318             |
| 1         | 75          | 234             |
| 2         | 75          | 294             |
| 1         | 76          | 925             |
| 2         | 76          | 2081            |
| 3         | 76          | 435             |
| 1         | 77          | 120             |
| 2         | 77          | 501             |
| 3         | 77          | 797             |
| 1         | 78          | 694             |
| 2         | 78          | -762            |
| 3         | 78          | -717            |
| 4         | 78          | -976            |
| 1         | 79          | 521             |
| 2         | 79          | 1380            |
| 1         | 80          | 795             |
| 2         | 80          | 1190            |
| 3         | 80          | 622             |
| 4         | 80          | 199             |
| 1         | 81          | 403             |
| 2         | 81          | -957            |
| 3         | 81          | -1106           |
| 4         | 81          | -1984           |
| 1         | 82          | -3912           |
| 2         | 82          | -3986           |
| 3         | 82          | -3249           |
| 4         | 82          | -4614           |
| 1         | 83          | 1099            |
| 2         | 83          | -692            |
| 3         | 83          | -742            |
| 4         | 83          | -377            |
| 1         | 84          | 968             |
| 3         | 84          | 609             |
| 1         | 85          | 467             |
| 3         | 85          | 1076            |
| 4         | 85          | 646             |
| 1         | 86          | 872             |
| 2         | 86          | -504            |
| 3         | 86          | 93              |
| 1         | 87          | -365            |
| 2         | 87          | -1366           |
| 3         | 87          | -1563           |
| 4         | 87          | -1195           |
| 1         | 88          | -35             |
| 2         | 88          | 752             |
| 3         | 88          | -736            |
| 4         | 88          | -820            |
| 1         | 89          | 210             |
| 2         | 89          | -1679           |
| 3         | 89          | -2653           |
| 4         | 89          | -3147           |
| 1         | 90          | 1772            |
| 2         | 90          | -1235           |
| 3         | 90          | -1624           |
| 4         | 90          | -1846           |
| 1         | 91          | -47             |
| 2         | 91          | -959            |
| 3         | 91          | -2660           |
| 4         | 91          | -2495           |
| 1         | 92          | 985             |
| 3         | 92          | 142             |
| 1         | 93          | 399             |
| 2         | 93          | 1103            |
| 3         | 93          | 1186            |
| 4         | 93          | 968             |
| 1         | 94          | -766            |
| 2         | 94          | -1496           |
| 3         | 94          | -1542           |
| 1         | 95          | 217             |
| 2         | 95          | 960             |
| 3         | 95          | 1446            |
| 1         | 96          | 1048            |
| 2         | 96          | 1537            |
| 3         | 96          | 942             |
| 1         | 97          | 623             |
| 2         | 97          | -240            |
| 3         | 97          | -2483           |
| 1         | 98          | 622             |
| 2         | 98          | 287             |
| 3         | 98          | -95             |
| 4         | 98          | 750             |
| 1         | 99          | 949             |
| 2         | 99          | 760             |
| 3         | 99          | 737             |
| 1         | 100         | 1081            |
| 2         | 100         | -497            |
| 3         | 100         | -1451           |
| 1         | 101         | -484            |
| 2         | 101         | -1324           |
| 3         | 101         | -2673           |
| 1         | 102         | 917             |
| 2         | 102         | 1428            |
| 3         | 102         | 1865            |
| 4         | 102         | 646             |
| 1         | 103         | 240             |
| 2         | 103         | -850            |
| 3         | 103         | -2257           |
| 1         | 104         | 615             |
| 2         | 104         | 1087            |
| 3         | 104         | 1190            |
| 1         | 105         | 1014            |
| 2         | 105         | 166             |
| 3         | 105         | 27              |
| 4         | 105         | -186            |
| 1         | 106         | -109            |
| 2         | 106         | 846             |
| 3         | 106         | -111            |
| 4         | 106         | -1462           |
| 1         | 107         | -144            |
| 2         | 107         | -690            |
| 1         | 108         | 530             |
| 2         | 108         | 738             |
| 3         | 108         | 1546            |
| 4         | 108         | 2680            |
| 1         | 109         | 429             |
| 2         | 109         | 2491            |
| 1         | 110         | 1258            |
| 2         | 110         | 1198            |
| 3         | 110         | 2233            |
| 1         | 111         | 101             |
| 2         | 111         | 463             |
| 3         | 111         | 99              |
| 1         | 112         | 945             |
| 2         | 112         | 893             |
| 3         | 112         | -116            |
| 1         | 113         | -511            |
| 2         | 113         | 62              |
| 3         | 113         | 12              |
| 4         | 113         | -1140           |
| 1         | 114         | 743             |
| 3         | 114         | 169             |
| 4         | 114         | 1143            |
| 1         | 115         | 144             |
| 2         | 115         | -845            |
| 3         | 115         | 884             |
| 4         | 115         | -41             |
| 1         | 116         | 167             |
| 2         | 116         | 53              |
| 3         | 116         | 543             |
| 4         | 116         | 330             |
| 1         | 117         | -25             |
| 2         | 117         | -216            |
| 3         | 117         | -706            |
| 1         | 118         | -683            |
| 2         | 118         | -513            |
| 3         | 118         | -1427           |
| 1         | 119         | 62              |
| 3         | 119         | -907            |
| 4         | 119         | -490            |
| 1         | 120         | 824             |
| 2         | 120         | 1913            |
| 3         | 120         | -900            |
| 4         | 120         | -1465           |
| 1         | 121         | 1992            |
| 2         | 121         | 1296            |
| 3         | 121         | -425            |
| 1         | 122         | 314             |
| 2         | 122         | 252             |
| 3         | 122         | 1347            |
| 4         | 122         | 1066            |
| 1         | 123         | -717            |
| 2         | 123         | -2277           |
| 3         | 123         | -1584           |
| 4         | 123         | -2128           |
| 1         | 124         | 731             |
| 2         | 124         | 1878            |
| 3         | 124         | 1301            |
| 1         | 125         | -791            |
| 2         | 125         | -2479           |
| 3         | 125         | -2436           |
| 1         | 126         | -786            |
| 2         | 126         | -716            |
| 3         | 126         | -2822           |
| 1         | 127         | 217             |
| 2         | 127         | 703             |
| 4         | 127         | 1672            |
| 1         | 128         | 410             |
| 2         | 128         | 144             |
| 3         | 128         | -776            |
| 4         | 128         | -202            |
| 1         | 129         | 466             |
| 2         | 129         | -796            |
| 3         | 129         | 68              |
| 4         | 129         | -2007           |
| 1         | 130         | -248            |
| 2         | 130         | -1160           |
| 3         | 130         | 132             |
| 1         | 131         | 480             |
| 2         | 131         | -983            |
| 3         | 131         | -152            |
| 1         | 132         | -1254           |
| 2         | 132         | -2844           |
| 3         | 132         | -5256           |
| 4         | 132         | -5585           |
| 1         | 133         | -356            |
| 2         | 133         | -368            |
| 1         | 134         | 3194            |
| 2         | 134         | 2748            |
| 3         | 134         | 1768            |
| 1         | 135         | 104             |
| 2         | 135         | 977             |
| 3         | 135         | 1001            |
| 1         | 136         | 479             |
| 2         | 136         | 966             |
| 3         | 136         | 383             |
| 4         | 136         | -133            |
| 1         | 137         | 396             |
| 2         | 137         | -356            |
| 1         | 138         | 1316            |
| 2         | 138         | 320             |
| 3         | 138         | 75              |
| 4         | 138         | -775            |
| 1         | 139         | 44              |
| 2         | 139         | 504             |
| 3         | 139         | 537             |
| 1         | 140         | 803             |
| 2         | 140         | 1526            |
| 3         | 140         | 2345            |
| 4         | 140         | 1495            |
| 1         | 141         | -369            |
| 2         | 141         | 1483            |
| 3         | 141         | 2113            |
| 4         | 141         | 2538            |
| 1         | 142         | 1378            |
| 2         | 142         | 440             |
| 3         | 142         | 217             |
| 4         | 142         | 863             |
| 1         | 143         | 807             |
| 2         | 143         | 1625            |
| 3         | 143         | 26              |
| 4         | 143         | -2457           |
| 1         | 144         | -735            |
| 2         | 144         | -3280           |
| 3         | 144         | -3046           |
| 4         | 144         | -4395           |
| 1         | 145         | -3051           |
| 2         | 145         | -1970           |
| 3         | 145         | -4119           |
| 1         | 146         | -807            |
| 2         | 146         | -3267           |
| 3         | 146         | -3781           |
| 4         | 146         | -3717           |
| 1         | 147         | 600             |
| 2         | 147         | 1698            |
| 1         | 148         | 88              |
| 2         | 148         | -2467           |
| 3         | 148         | -2076           |
| 4         | 148         | -2730           |
| 1         | 149         | 344             |
| 2         | 149         | 321             |
| 3         | 149         | -202            |
| 1         | 150         | -600            |
| 2         | 150         | -1512           |
| 3         | 150         | -1604           |
| 4         | 150         | -2429           |
| 1         | 151         | 1367            |
| 2         | 151         | 5               |
| 3         | 151         | -887            |
| 1         | 152         | 1831            |
| 2         | 152         | 1902            |
| 3         | 152         | 1984            |
| 1         | 153         | -1954           |
| 2         | 153         | -776            |
| 3         | 153         | -1695           |
| 1         | 154         | -1392           |
| 2         | 154         | -2340           |
| 3         | 154         | -2104           |
| 4         | 154         | -2555           |
| 1         | 155         | -996            |
| 2         | 155         | -2941           |
| 3         | 155         | -3377           |
| 4         | 155         | -4530           |
| 1         | 156         | 82              |
| 4         | 156         | 312             |
| 1         | 157         | 138             |
| 2         | 157         | -611            |
| 3         | 157         | 2766            |
| 1         | 158         | 56              |
| 2         | 158         | -136            |
| 3         | 158         | -1106           |
| 1         | 159         | -301            |
| 1         | 160         | 843             |
| 2         | 160         | 543             |
| 3         | 160         | -69             |
| 4         | 160         | -307            |
| 1         | 161         | -1121           |
| 2         | 161         | -961            |
| 3         | 161         | -291            |
| 1         | 162         | 123             |
| 2         | 162         | 784             |
| 1         | 163         | -73             |
| 2         | 163         | -328            |
| 3         | 163         | -3116           |
| 4         | 163         | -3055           |
| 1         | 164         | 548             |
| 2         | 164         | 957             |
| 1         | 165         | -61             |
| 2         | 165         | -1088           |
| 3         | 165         | -3701           |
| 4         | 165         | -3931           |
| 1         | 166         | 957             |
| 2         | 166         | 1546            |
| 3         | 166         | 1303            |
| 4         | 166         | 1783            |
| 1         | 167         | 51              |
| 2         | 167         | 574             |
| 3         | 167         | -566            |
| 4         | 167         | -748            |
| 1         | 168         | 114             |
| 2         | 168         | -801            |
| 1         | 169         | -569            |
| 2         | 169         | -1190           |
| 3         | 169         | 9               |
| 4         | 169         | 906             |
| 1         | 170         | -38             |
| 2         | 170         | -373            |
| 3         | 170         | -137            |
| 4         | 170         | -850            |
| 1         | 171         | -197            |
| 2         | 171         | -1400           |
| 3         | 171         | -1921           |
| 4         | 171         | -911            |
| 1         | 172         | -174            |
| 3         | 172         | -1038           |
| 1         | 173         | 1298            |
| 2         | 173         | 1398            |
| 3         | 173         | 912             |
| 4         | 173         | 121             |
| 1         | 174         | 1142            |
| 2         | 174         | -98             |
| 3         | 174         | -1135           |
| 4         | 174         | 644             |
| 1         | 175         | -326            |
| 2         | 175         | -755            |
| 3         | 175         | -1822           |
| 4         | 175         | -1549           |
| 1         | 176         | 655             |
| 2         | 176         | 605             |
| 3         | 176         | -531            |
| 4         | 176         | -1067           |
| 1         | 177         | 405             |
| 2         | 177         | -156            |
| 3         | 177         | 800             |
| 4         | 177         | -974            |
| 1         | 178         | 252             |
| 2         | 178         | 387             |
| 3         | 178         | 390             |
| 4         | 178         | -1983           |
| 1         | 179         | -1754           |
| 2         | 179         | -3386           |
| 3         | 179         | -7953           |
| 1         | 180         | -838            |
| 2         | 180         | -1808           |
| 3         | 180         | -2804           |
| 4         | 180         | -3175           |
| 1         | 181         | -47             |
| 2         | 181         | -843            |
| 3         | 181         | -2640           |
| 1         | 182         | 97              |
| 2         | 182         | -45             |
| 3         | 182         | -843            |
| 4         | 182         | -159            |
| 1         | 183         | -540            |
| 2         | 183         | -3729           |
| 3         | 183         | -6083           |
| 4         | 183         | -6560           |
| 1         | 184         | 472             |
| 2         | 184         | -331            |
| 3         | 184         | -2530           |
| 4         | 184         | -3178           |
| 1         | 185         | 626             |
| 2         | 185         | -11             |
| 3         | 185         | -1001           |
| 4         | 185         | -505            |
| 1         | 186         | 534             |
| 2         | 186         | 1345            |
| 3         | 186         | 1930            |
| 4         | 186         | 1284            |
| 1         | 187         | -211            |
| 2         | 187         | -1379           |
| 3         | 187         | -3060           |
| 4         | 187         | -2272           |
| 1         | 188         | -184            |
| 2         | 188         | 1013            |
| 3         | 188         | 52              |
| 4         | 188         | -475            |
| 1         | 189         | -838            |
| 2         | 189         | -2101           |
| 3         | 189         | -4007           |
| 1         | 190         | 14              |
| 2         | 190         | 459             |
| 3         | 190         | 523             |
| 4         | 190         | 1178            |
| 1         | 191         | 1632            |
| 2         | 191         | 1306            |
| 3         | 191         | 1036            |
| 4         | 191         | 879             |
| 1         | 192         | 2526            |
| 2         | 192         | -689            |
| 3         | 192         | 383             |
| 4         | 192         | 1139            |
| 1         | 193         | 689             |
| 3         | 193         | 486             |
| 1         | 194         | 137             |
| 2         | 194         | -2211           |
| 3         | 194         | 178             |
| 4         | 194         | -697            |
| 1         | 195         | 489             |
| 3         | 195         | 406             |
| 1         | 196         | 734             |
| 2         | 196         | 1295            |
| 3         | 196         | 1382            |
| 1         | 197         | -446            |
| 2         | 197         | 137             |
| 3         | 197         | 1023            |
| 4         | 197         | 3685            |
| 1         | 198         | 1144            |
| 2         | 198         | 288             |
| 3         | 198         | -1253           |
| 4         | 198         | -757            |
| 1         | 199         | 530             |
| 2         | 199         | 515             |
| 3         | 199         | -14             |
| 4         | 199         | -220            |
| 1         | 200         | 997             |
| 2         | 200         | 1356            |
| 3         | 200         | 2914            |
| 4         | 200         | 2853            |
| 1         | 201         | -383            |
| 2         | 201         | -292            |
| 3         | 201         | 1529            |
| 1         | 202         | -530            |
| 2         | 202         | -916            |
| 3         | 202         | -2415           |
| 1         | 203         | 2528            |
| 2         | 203         | 3471            |
| 3         | 203         | 3461            |
| 4         | 203         | 3437            |
| 1         | 204         | 749             |
| 2         | 204         | 1039            |
| 3         | 204         | 1587            |
| 4         | 204         | 1893            |
| 1         | 205         | -82             |
| 2         | 205         | 1211            |
| 3         | 205         | 1067            |
| 1         | 206         | -215            |
| 2         | 206         | -949            |
| 3         | 206         | -4974           |
| 4         | 206         | -5374           |
| 1         | 207         | 322             |
| 2         | 207         | -1954           |
| 3         | 207         | -2152           |
| 4         | 207         | -1014           |
| 1         | 208         | 537             |
| 2         | 208         | 406             |
| 4         | 208         | 1361            |
| 1         | 209         | -202            |
| 2         | 209         | -766            |
| 3         | 209         | -1266           |
| 4         | 209         | -2351           |
| 1         | 210         | 60              |
| 2         | 210         | -1361           |
| 3         | 210         | -1309           |
| 4         | 210         | -792            |
| 1         | 211         | 607             |
| 2         | 211         | 1839            |
| 3         | 211         | 257             |
| 4         | 211         | -602            |
| 1         | 212         | -336            |
| 2         | 212         | 481             |
| 3         | 212         | 3529            |
| 1         | 213         | -239            |
| 2         | 213         | -1199           |
| 3         | 213         | -1184           |
| 4         | 213         | -1717           |
| 1         | 214         | -445            |
| 2         | 214         | -1511           |
| 3         | 214         | 83              |
| 4         | 214         | 802             |
| 1         | 215         | 822             |
| 2         | 215         | 1770            |
| 3         | 215         | 697             |
| 4         | 215         | 414             |
| 1         | 216         | 1619            |
| 2         | 216         | 3302            |
| 3         | 216         | 872             |
| 4         | 216         | -110            |
| 1         | 217         | 870             |
| 2         | 217         | 1839            |
| 3         | 217         | 9               |
| 1         | 218         | 208             |
| 2         | 218         | -1620           |
| 3         | 218         | -465            |
| 4         | 218         | 1167            |
| 1         | 219         | 165             |
| 2         | 219         | -845            |
| 3         | 219         | 1108            |
| 4         | 219         | 306             |
| 1         | 220         | 307             |
| 2         | 220         | 714             |
| 3         | 220         | -29             |
| 4         | 220         | -958            |
| 1         | 221         | 1384            |
| 2         | 221         | 1481            |
| 3         | 221         | 1055            |
| 1         | 222         | 657             |
| 2         | 222         | 1997            |
| 3         | 222         | 1136            |
| 4         | 222         | 1532            |
| 1         | 223         | 396             |
| 2         | 223         | -1100           |
| 3         | 223         | -1723           |
| 4         | 223         | -2435           |
| 1         | 224         | 487             |
| 2         | 224         | -206            |
| 3         | 224         | -1581           |
| 4         | 224         | -1369           |
| 1         | 225         | 280             |
| 2         | 225         | -89             |
| 3         | 225         | 297             |
| 1         | 226         | -980            |
| 2         | 226         | -586            |
| 3         | 226         | -1855           |
| 4         | 226         | -1430           |
| 1         | 227         | -622            |
| 2         | 227         | -1045           |
| 3         | 227         | -2336           |
| 4         | 227         | -3161           |
| 1         | 228         | 294             |
| 2         | 228         | -253            |
| 3         | 228         | -1724           |
| 1         | 229         | 621             |
| 2         | 229         | 1618            |
| 3         | 229         | 703             |
| 1         | 230         | 499             |
| 2         | 230         | 990             |
| 3         | 230         | 2428            |
| 4         | 230         | 2356            |
| 1         | 231         | -236            |
| 2         | 231         | -534            |
| 3         | 231         | -2010           |
| 4         | 231         | -2475           |
| 1         | 232         | 1418            |
| 2         | 232         | 864             |
| 3         | 232         | 923             |
| 1         | 233         | 1795            |
| 2         | 233         | 2910            |
| 3         | 233         | 3742            |
| 1         | 234         | -200            |
| 2         | 234         | 322             |
| 3         | 234         | -2276           |
| 1         | 235         | -1963           |
| 2         | 235         | -476            |
| 3         | 235         | 24              |
| 1         | 236         | 356             |
| 2         | 236         | 1059            |
| 3         | 236         | 924             |
| 4         | 236         | -100            |
| 1         | 237         | -174            |
| 2         | 237         | 136             |
| 3         | 237         | 1567            |
| 4         | 237         | 812             |
| 1         | 238         | 802             |
| 2         | 238         | 1270            |
| 4         | 238         | -479            |
| 1         | 239         | -10             |
| 2         | 239         | 706             |
| 3         | 239         | 574             |
| 4         | 239         | 1871            |
| 1         | 240         | 1108            |
| 2         | 240         | 754             |
| 3         | 240         | 3200            |
| 4         | 240         | 3075            |
| 1         | 241         | 20              |
| 1         | 242         | 1143            |
| 2         | 242         | -462            |
| 3         | 242         | -1891           |
| 4         | 242         | -3334           |
| 1         | 243         | -368            |
| 3         | 243         | 979             |
| 1         | 244         | 728             |
| 2         | 244         | 1752            |
| 3         | 244         | 1930            |
| 4         | 244         | 877             |
| 1         | 245         | 76              |
| 2         | 245         | -341            |
| 3         | 245         | -1791           |
| 4         | 245         | -1021           |
| 1         | 246         | 506             |
| 2         | 246         | 584             |
| 3         | 246         | 277             |
| 4         | 246         | -2132           |
| 1         | 247         | 983             |
| 2         | 247         | 577             |
| 3         | 247         | 297             |
| 1         | 248         | 304             |
| 2         | 248         | 667             |
| 3         | 248         | 955             |
| 4         | 248         | 1188            |
| 1         | 249         | 336             |
| 3         | 249         | 1065            |
| 4         | 249         | 895             |
| 1         | 250         | 149             |
| 2         | 250         | 0               |
| 3         | 250         | 177             |
| 4         | 250         | -1555           |
| 1         | 251         | 1276            |
| 2         | 251         | -924            |
| 3         | 251         | -1230           |
| 4         | 251         | -1883           |
| 1         | 252         | 289             |
| 4         | 252         | 133             |
| 1         | 253         | -578            |
| 2         | 253         | -577            |
| 3         | 253         | -457            |
| 4         | 253         | -484            |
| 1         | 254         | 36              |
| 2         | 254         | -2883           |
| 3         | 254         | -590            |
| 1         | 255         | 253             |
| 2         | 255         | 129             |
| 3         | 255         | -548            |
| 1         | 256         | 1743            |
| 2         | 256         | 906             |
| 3         | 256         | 1152            |
| 4         | 256         | 1094            |
| 1         | 257         | 414             |
| 2         | 257         | -1609           |
| 3         | 257         | -472            |
| 4         | 257         | -976            |
| 1         | 258         | 590             |
| 2         | 258         | -1076           |
| 3         | 258         | -2893           |
| 4         | 258         | -1465           |
| 1         | 259         | 928             |
| 2         | 259         | -267            |
| 3         | 259         | -1458           |
| 1         | 260         | 1865            |
| 3         | 260         | 1909            |
| 1         | 261         | 746             |
| 2         | 261         | 1408            |
| 3         | 261         | -329            |
| 4         | 261         | -31             |
| 1         | 262         | -1070           |
| 2         | 262         | -2599           |
| 3         | 262         | -2372           |
| 1         | 263         | 312             |
| 2         | 263         | 112             |
| 4         | 263         | 770             |
| 1         | 264         | 770             |
| 2         | 264         | 1545            |
| 3         | 264         | 2088            |
| 4         | 264         | 1295            |
| 1         | 265         | -25             |
| 2         | 265         | -1481           |
| 3         | 265         | -2592           |
| 4         | 265         | -1948           |
| 1         | 266         | 651             |
| 2         | 266         | 1455            |
| 3         | 266         | 787             |
| 4         | 266         | 1138            |
| 1         | 267         | -193            |
| 2         | 267         | -2068           |
| 3         | 267         | -5236           |
| 4         | 267         | -2442           |
| 1         | 268         | 1699            |
| 2         | 268         | 123             |
| 3         | 268         | 270             |
| 4         | 268         | -218            |
| 1         | 269         | -2665           |
| 2         | 269         | -3985           |
| 3         | 269         | -2470           |
| 4         | 269         | -1864           |
| 1         | 270         | 1395            |
| 2         | 270         | 961             |
| 3         | 270         | 599             |
| 4         | 270         | -442            |
| 1         | 271         | -1586           |
| 2         | 271         | 272             |
| 3         | 271         | -616            |
| 4         | 271         | 180             |
| 1         | 272         | -228            |
| 2         | 272         | -1673           |
| 4         | 272         | -1769           |
| 1         | 273         | 876             |
| 2         | 273         | 133             |
| 3         | 273         | -178            |
| 4         | 273         | 308             |
| 1         | 274         | -780            |
| 2         | 274         | -582            |
| 3         | 274         | 124             |
| 1         | 275         | 211             |
| 2         | 275         | -1325           |
| 3         | 275         | -2973           |
| 4         | 275         | -3169           |
| 1         | 276         | -851            |
| 2         | 276         | -796            |
| 3         | 276         | -1944           |
| 1         | 277         | 615             |
| 2         | 277         | 1411            |
| 3         | 277         | 1865            |
| 1         | 278         | 1309            |
| 2         | 278         | 1723            |
| 3         | 278         | 2026            |
| 4         | 278         | 3554            |
| 1         | 279         | 1895            |
| 2         | 279         | 3641            |
| 3         | 279         | 4183            |
| 4         | 279         | 4103            |
| 1         | 280         | -87             |
| 2         | 280         | -185            |
| 3         | 280         | -373            |
| 1         | 281         | 220             |
| 2         | 281         | 1055            |
| 3         | 281         | 2192            |
| 4         | 281         | 3004            |
| 1         | 282         | 74              |
| 2         | 282         | -713            |
| 3         | 282         | -1661           |
| 4         | 282         | -1311           |
| 1         | 283         | -1201           |
| 2         | 283         | -2818           |
| 3         | 283         | -5721           |
| 4         | 283         | -7145           |
| 1         | 284         | 257             |
| 2         | 284         | -2602           |
| 3         | 284         | -2826           |
| 4         | 284         | -3379           |
| 1         | 285         | 360             |
| 2         | 285         | 1358            |
| 3         | 285         | 1965            |
| 1         | 286         | 177             |
| 2         | 286         | 171             |
| 1         | 287         | 658             |
| 2         | 287         | 829             |
| 3         | 287         | 886             |
| 4         | 287         | -406            |
| 1         | 288         | 778             |
| 2         | 288         | -867            |
| 3         | 288         | -515            |
| 1         | 289         | 838             |
| 2         | 289         | -207            |
| 3         | 289         | -934            |
| 4         | 289         | -1059           |
| 1         | 290         | 785             |
| 2         | 290         | 1139            |
| 3         | 290         | 2061            |
| 4         | 290         | 21              |
| 1         | 291         | 930             |
| 4         | 291         | 531             |
| 1         | 292         | -3458           |
| 2         | 292         | -4646           |
| 3         | 292         | -4760           |
| 1         | 293         | -383            |
| 2         | 293         | -1452           |
| 3         | 293         | -1770           |
| 4         | 293         | -2500           |
| 1         | 294         | 307             |
| 2         | 294         | 1557            |
| 3         | 294         | 707             |
| 1         | 295         | 636             |
| 2         | 295         | 496             |
| 3         | 295         | 1430            |
| 4         | 295         | -177            |
| 1         | 296         | 191             |
| 2         | 296         | 1152            |
| 3         | 296         | 1309            |
| 4         | 296         | 2220            |
| 1         | 297         | 550             |
| 2         | 297         | 585             |
| 3         | 297         | 1004            |
| 4         | 297         | 1282            |
| 1         | 298         | 278             |
| 2         | 298         | -580            |
| 3         | 298         | 767             |
| 4         | 298         | 1489            |
| 1         | 299         | 961             |
| 2         | 299         | 1246            |
| 3         | 299         | 70              |
| 1         | 300         | 672             |
| 2         | 300         | -949            |
| 3         | 300         | -2374           |
| 4         | 300         | -3179           |
| 1         | 301         | -906            |
| 2         | 301         | -1977           |
| 3         | 301         | -3636           |
| 4         | 301         | -3529           |
| 1         | 302         | -1499           |
| 2         | 302         | -2077           |
| 3         | 302         | -2410           |
| 4         | 302         | -1795           |
| 1         | 303         | 332             |
| 2         | 303         | 465             |
| 3         | 303         | -629            |
| 4         | 303         | -660            |
| 1         | 304         | 152             |
| 2         | 304         | -1360           |
| 3         | 304         | -2420           |
| 4         | 304         | -2047           |
| 1         | 305         | 20              |
| 2         | 305         | 189             |
| 3         | 305         | -56             |
| 1         | 306         | 402             |
| 3         | 306         | 0               |
| 4         | 306         | 1565            |
| 1         | 307         | -696            |
| 2         | 307         | 750             |
| 3         | 307         | 525             |
| 4         | 307         | 62              |
| 1         | 308         | -561            |
| 2         | 308         | 316             |
| 3         | 308         | 710             |
| 4         | 308         | 971             |
| 1         | 309         | -363            |
| 2         | 309         | -2404           |
| 3         | 309         | -1813           |
| 4         | 309         | -960            |
| 1         | 310         | 860             |
| 2         | 310         | 156             |
| 3         | 310         | 3066            |
| 1         | 311         | 310             |
| 2         | 311         | 1006            |
| 3         | 311         | -955            |
| 4         | 311         | -1055           |
| 1         | 312         | 485             |
| 2         | 312         | 656             |
| 3         | 312         | -1065           |
| 4         | 312         | -2318           |
| 1         | 313         | 901             |
| 2         | 313         | 972             |
| 3         | 313         | -1311           |
| 4         | 313         | -34             |
| 1         | 314         | 448             |
| 2         | 314         | -633            |
| 3         | 314         | 91              |
| 4         | 314         | -249            |
| 1         | 315         | 1295            |
| 2         | 315         | 1349            |
| 3         | 315         | 2287            |
| 1         | 316         | 184             |
| 2         | 316         | -2483           |
| 3         | 316         | -3299           |
| 1         | 317         | 869             |
| 2         | 317         | 1232            |
| 4         | 317         | 995             |
| 1         | 318         | 321             |
| 2         | 318         | -342            |
| 3         | 318         | -1648           |
| 1         | 319         | 83              |
| 2         | 319         | -703            |
| 3         | 319         | -488            |
| 1         | 320         | 2426            |
| 2         | 320         | 1909            |
| 3         | 320         | 2239            |
| 4         | 320         | 2851            |
| 1         | 321         | 243             |
| 2         | 321         | -213            |
| 4         | 321         | 572             |
| 1         | 322         | 1949            |
| 2         | 322         | 2471            |
| 3         | 322         | 1811            |
| 1         | 323         | 1323            |
| 2         | 323         | -1880           |
| 3         | 323         | -4196           |
| 4         | 323         | -5221           |
| 1         | 324         | 203             |
| 2         | 324         | 967             |
| 3         | 324         | 1470            |
| 1         | 325         | 60              |
| 2         | 325         | -1878           |
| 3         | 325         | -1862           |
| 1         | 326         | -211            |
| 2         | 326         | 417             |
| 1         | 327         | 919             |
| 3         | 327         | -164            |
| 1         | 328         | -1232           |
| 2         | 328         | -3426           |
| 3         | 328         | -4703           |
| 4         | 328         | -4559           |
| 1         | 329         | 831             |
| 2         | 329         | 2               |
| 3         | 329         | -626            |
| 4         | 329         | 736             |
| 1         | 330         | 826             |
| 2         | 330         | 1099            |
| 3         | 330         | -666            |
| 4         | 330         | -1474           |
| 1         | 331         | -54             |
| 2         | 331         | -173            |
| 3         | 331         | -949            |
| 1         | 332         | 202             |
| 2         | 332         | 559             |
| 3         | 332         | 494             |
| 4         | 332         | 670             |
| 1         | 333         | -229            |
| 2         | 333         | -127            |
| 3         | 333         | 567             |
| 4         | 333         | 920             |
| 1         | 334         | 1177            |
| 2         | 334         | 2724            |
| 3         | 334         | 2425            |
| 4         | 334         | 1614            |
| 1         | 335         | 570             |
| 2         | 335         | -354            |
| 3         | 335         | 423             |
| 1         | 336         | 543             |
| 2         | 336         | -595            |
| 3         | 336         | 135             |
| 4         | 336         | 599             |
| 1         | 337         | -264            |
| 2         | 337         | 170             |
| 3         | 337         | 1450            |
| 4         | 337         | 1314            |
| 1         | 338         | 262             |
| 2         | 338         | 533             |
| 3         | 338         | 2767            |
| 4         | 338         | 1264            |
| 1         | 339         | -780            |
| 2         | 339         | 1088            |
| 3         | 339         | 625             |
| 1         | 340         | -1086           |
| 2         | 340         | 276             |
| 3         | 340         | 559             |
| 4         | 340         | 1390            |
| 1         | 341         | 345             |
| 2         | 341         | -873            |
| 3         | 341         | -2133           |
| 4         | 341         | -2094           |
| 1         | 342         | 347             |
| 2         | 342         | -285            |
| 3         | 342         | 503             |
| 4         | 342         | -135            |
| 1         | 343         | 1339            |
| 2         | 343         | 1653            |
| 3         | 343         | 1841            |
| 1         | 344         | -932            |
| 2         | 344         | 505             |
| 3         | 344         | 1475            |
| 1         | 345         | -100            |
| 2         | 345         | -650            |
| 3         | 345         | -2288           |
| 1         | 346         | 916             |
| 2         | 346         | -1052           |
| 4         | 346         | -3802           |
| 1         | 347         | 394             |
| 2         | 347         | -775            |
| 3         | 347         | -1768           |
| 1         | 348         | -771            |
| 2         | 348         | 114             |
| 3         | 348         | -155            |
| 4         | 348         | 48              |
| 1         | 349         | -844            |
| 2         | 349         | -1040           |
| 3         | 349         | 1309            |
| 4         | 349         | 1964            |
| 1         | 350         | 2200            |
| 2         | 350         | 1080            |
| 3         | 350         | -174            |
| 4         | 350         | -1233           |
| 1         | 351         | 90              |
| 2         | 351         | -1533           |
| 3         | 351         | -1860           |
| 1         | 352         | 416             |
| 2         | 352         | -1612           |
| 3         | 352         | -1774           |
| 4         | 352         | -2269           |
| 1         | 353         | -555            |
| 2         | 353         | -1819           |
| 3         | 353         | -516            |
| 1         | 354         | 822             |
| 3         | 354         | 158             |
| 1         | 355         | -245            |
| 2         | 355         | -194            |
| 3         | 355         | -1137           |
| 4         | 355         | -852            |
| 1         | 356         | -1870           |
| 2         | 356         | -3929           |
| 3         | 356         | -6518           |
| 4         | 356         | -6882           |
| 1         | 357         | 780             |
| 2         | 357         | 878             |
| 3         | 357         | 496             |
| 4         | 357         | -188            |
| 1         | 358         | -1062           |
| 2         | 358         | -619            |
| 3         | 358         | -883            |
| 4         | 358         | -708            |
| 1         | 359         | 890             |
| 2         | 359         | 1284            |
| 3         | 359         | 3159            |
| 4         | 359         | 2878            |
| 1         | 360         | -1306           |
| 2         | 360         | -427            |
| 3         | 360         | -1255           |
| 4         | 360         | -324            |
| 1         | 361         | 340             |
| 2         | 361         | 772             |
| 1         | 362         | 416             |
| 2         | 362         | 481             |
| 3         | 362         | -564            |
| 4         | 362         | 615             |
| 1         | 363         | 977             |
| 2         | 363         | -618            |
| 3         | 363         | -3065           |
| 4         | 363         | -2886           |
| 1         | 364         | -57             |
| 2         | 364         | -456            |
| 3         | 364         | 1173            |
| 4         | 364         | 811             |
| 1         | 365         | -68             |
| 2         | 365         | 244             |
| 3         | 365         | -75             |
| 4         | 365         | -760            |
| 1         | 366         | -51             |
| 2         | 366         | -93             |
| 3         | 366         | -1305           |
| 4         | 366         | -1096           |
| 1         | 367         | 239             |
| 2         | 367         | -467            |
| 3         | 367         | -3101           |
| 4         | 367         | -1697           |
| 1         | 368         | -526            |
| 2         | 368         | -3490           |
| 3         | 368         | -1476           |
| 4         | 368         | -2860           |
| 1         | 369         | 266             |
| 3         | 369         | 1679            |
| 1         | 370         | -2295           |
| 2         | 370         | -1635           |
| 3         | 370         | -1311           |
| 4         | 370         | -1496           |
| 1         | 371         | -134            |
| 2         | 371         | -154            |
| 3         | 371         | -5              |
| 4         | 371         | -1243           |
| 1         | 372         | 2718            |
| 2         | 372         | 1241            |
| 3         | 372         | -1625           |
| 1         | 373         | 493             |
| 2         | 373         | 277             |
| 3         | 373         | 1057            |
| 4         | 373         | 1451            |
| 1         | 374         | -457            |
| 2         | 374         | -1292           |
| 3         | 374         | -846            |
| 1         | 375         | 647             |
| 2         | 375         | 328             |
| 3         | 375         | -440            |
| 4         | 375         | -1291           |
| 1         | 376         | 1614            |
| 2         | 376         | 2515            |
| 3         | 376         | 3062            |
| 1         | 377         | 252             |
| 2         | 377         | -182            |
| 4         | 377         | -785            |
| 1         | 378         | 484             |
| 2         | 378         | 2424            |
| 3         | 378         | 1590            |
| 1         | 379         | -35             |
| 2         | 379         | -268            |
| 4         | 379         | -1206           |
| 1         | 380         | -849            |
| 2         | 380         | -1481           |
| 3         | 380         | -3662           |
| 1         | 381         | 66              |
| 2         | 381         | 992             |
| 3         | 381         | 278             |
| 4         | 381         | -597            |
| 1         | 382         | -687            |
| 2         | 382         | -1195           |
| 3         | 382         | -1141           |
| 1         | 383         | -36             |
| 2         | 383         | 935             |
| 3         | 383         | -617            |
| 4         | 383         | 913             |
| 1         | 384         | -10             |
| 2         | 384         | -2486           |
| 3         | 384         | -2527           |
| 1         | 385         | -1174           |
| 3         | 385         | -4693           |
| 4         | 385         | -4861           |
| 1         | 386         | 1108            |
| 2         | 386         | 759             |
| 3         | 386         | -766            |
| 4         | 386         | -3837           |
| 1         | 387         | 1069            |
| 3         | 387         | 2551            |
| 4         | 387         | 2454            |
| 1         | 388         | 2243            |
| 2         | 388         | 1126            |
| 3         | 388         | 1598            |
| 4         | 388         | 1376            |
| 1         | 389         | -27             |
| 2         | 389         | 490             |
| 3         | 389         | 1214            |
| 4         | 389         | 2005            |
| 1         | 390         | -705            |
| 2         | 390         | -2038           |
| 3         | 390         | -1929           |
| 4         | 390         | -2801           |
| 1         | 391         | 603             |
| 2         | 391         | 2               |
| 3         | 391         | 272             |
| 4         | 391         | -90             |
| 1         | 392         | 816             |
| 2         | 392         | 2034            |
| 3         | 392         | 1498            |
| 4         | 392         | 1253            |
| 1         | 393         | 659             |
| 2         | 393         | 118             |
| 3         | 393         | 1500            |
| 4         | 393         | 639             |
| 1         | 394         | 3268            |
| 2         | 394         | 2644            |
| 3         | 394         | 1420            |
| 1         | 395         | -1782           |
| 2         | 395         | -914            |
| 3         | 395         | -903            |
| 4         | 395         | -1723           |
| 1         | 396         | -909            |
| 2         | 396         | -550            |
| 3         | 396         | -2848           |
| 1         | 397         | 973             |
| 2         | 397         | 1106            |
| 3         | 397         | 1709            |
| 1         | 398         | -429            |
| 2         | 398         | -3171           |
| 3         | 398         | -3401           |
| 1         | 399         | 593             |
| 2         | 399         | -301            |
| 3         | 399         | -1488           |
| 4         | 399         | -1717           |
| 1         | 400         | 155             |
| 2         | 400         | -409            |
| 4         | 400         | 1338            |
| 1         | 401         | 102             |
| 2         | 401         | -25             |
| 3         | 401         | 83              |
| 1         | 402         | 1478            |
| 2         | 402         | 1599            |
| 3         | 402         | 796             |
| 1         | 403         | 303             |
| 3         | 403         | 987             |
| 4         | 403         | 1047            |
| 1         | 404         | -245            |
| 2         | 404         | -347            |
| 3         | 404         | -2484           |
| 1         | 405         | -2897           |
| 2         | 405         | -4125           |
| 3         | 405         | -6882           |
| 4         | 405         | -7070           |
| 1         | 406         | 795             |
| 2         | 406         | 1131            |
| 3         | 406         | 2597            |
| 4         | 406         | 2279            |
| 1         | 407         | 7               |
| 2         | 407         | 46              |
| 3         | 407         | -900            |
| 4         | 407         | -3275           |
| 1         | 408         | -145            |
| 3         | 408         | 800             |
| 4         | 408         | -132            |
| 1         | 409         | 155             |
| 2         | 409         | 1371            |
| 3         | 409         | 2455            |
| 4         | 409         | 2623            |
| 1         | 410         | 1025            |
| 2         | 410         | 199             |
| 3         | 410         | -52             |
| 1         | 411         | 551             |
| 4         | 411         | -981            |
| 1         | 412         | 722             |
| 2         | 412         | 608             |
| 1         | 413         | 642             |
| 2         | 413         | 1072            |
| 4         | 413         | 801             |
| 1         | 414         | 439             |
| 3         | 414         | 1918            |
| 1         | 415         | 331             |
| 2         | 415         | -586            |
| 3         | 415         | -4287           |
| 1         | 416         | 756             |
| 2         | 416         | 1715            |
| 3         | 416         | 3324            |
| 4         | 416         | 3898            |
| 1         | 417         | 707             |
| 2         | 417         | -1079           |
| 3         | 417         | -1540           |
| 4         | 417         | -1847           |
| 1         | 418         | -499            |
| 2         | 418         | -996            |
| 3         | 418         | -1624           |
| 4         | 418         | -1828           |
| 1         | 419         | 1193            |
| 2         | 419         | 123             |
| 3         | 419         | -1280           |
| 1         | 420         | -280            |
| 2         | 420         | -2117           |
| 3         | 420         | -2457           |
| 4         | 420         | -2078           |
| 1         | 421         | -741            |
| 2         | 421         | -571            |
| 3         | 421         | -413            |
| 4         | 421         | 312             |
| 1         | 422         | 356             |
| 2         | 422         | -1661           |
| 3         | 422         | -1046           |
| 4         | 422         | -3357           |
| 1         | 423         | 361             |
| 2         | 423         | -262            |
| 3         | 423         | 1321            |
| 1         | 424         | -595            |
| 2         | 424         | -648            |
| 3         | 424         | -940            |
| 4         | 424         | -314            |
| 1         | 425         | 63              |
| 2         | 425         | -505            |
| 3         | 425         | 57              |
| 4         | 425         | -721            |
| 1         | 426         | -880            |
| 2         | 426         | -3802           |
| 3         | 426         | -4352           |
| 4         | 426         | -5352           |
| 1         | 427         | 588             |
| 2         | 427         | 1305            |
| 3         | 427         | 676             |
| 4         | 427         | -316            |
| 1         | 428         | 280             |
| 2         | 428         | 687             |
| 3         | 428         | 1217            |
| 1         | 429         | 82              |
| 2         | 429         | 473             |
| 3         | 429         | -46             |
| 4         | 429         | -901            |
| 1         | 430         | -8              |
| 2         | 430         | 403             |
| 3         | 430         | -1326           |
| 1         | 431         | -400            |
| 2         | 431         | -1139           |
| 1         | 432         | 392             |
| 2         | 432         | 986             |
| 3         | 432         | 963             |
| 4         | 432         | 2435            |
| 1         | 433         | 883             |
| 2         | 433         | 1286            |
| 3         | 433         | 660             |
| 1         | 434         | 1123            |
| 2         | 434         | -117            |
| 3         | 434         | -2366           |
| 4         | 434         | -1815           |
| 1         | 435         | -1329           |
| 2         | 435         | -38             |
| 3         | 435         | -1176           |
| 1         | 436         | 917             |
| 2         | 436         | 886             |
| 3         | 436         | -676            |
| 1         | 437         | -361            |
| 2         | 437         | -1537           |
| 3         | 437         | -1318           |
| 4         | 437         | -1134           |
| 1         | 438         | 1317            |
| 2         | 438         | 2813            |
| 3         | 438         | 1423            |
| 1         | 439         | 430             |
| 3         | 439         | -381            |
| 4         | 439         | 318             |
| 1         | 440         | -123            |
| 2         | 440         | 146             |
| 3         | 440         | 490             |
| 1         | 441         | -329            |
| 2         | 441         | 745             |
| 3         | 441         | -669            |
| 4         | 441         | -798            |
| 1         | 442         | 142             |
| 2         | 442         | -2898           |
| 3         | 442         | -4520           |
| 4         | 442         | -5499           |
| 1         | 443         | 760             |
| 2         | 443         | 710             |
| 3         | 443         | -359            |
| 4         | 443         | -11             |
| 1         | 444         | 83              |
| 2         | 444         | -1178           |
| 3         | 444         | -499            |
| 4         | 444         | -820            |
| 1         | 445         | 1364            |
| 2         | 445         | 894             |
| 3         | 445         | 724             |
| 4         | 445         | 312             |
| 1         | 446         | 412             |
| 3         | 446         | -53             |
| 4         | 446         | 405             |
| 1         | 447         | 1195            |
| 2         | 447         | 41              |
| 3         | 447         | -1290           |
| 1         | 448         | 1360            |
| 2         | 448         | -909            |
| 3         | 448         | -2042           |
| 4         | 448         | -2418           |
| 1         | 449         | -3100           |
| 2         | 449         | -3928           |
| 3         | 449         | -3045           |
| 1         | 450         | 469             |
| 2         | 450         | -159            |
| 3         | 450         | -737            |
| 4         | 450         | -36             |
| 1         | 451         | 910             |
| 2         | 451         | -1313           |
| 3         | 451         | -645            |
| 4         | 451         | -756            |
| 1         | 452         | 1360            |
| 2         | 452         | 1654            |
| 3         | 452         | 1613            |
| 1         | 453         | 638             |
| 2         | 453         | 811             |
| 3         | 453         | -595            |
| 4         | 453         | 117             |
| 1         | 454         | 11              |
| 2         | 454         | 2163            |
| 3         | 454         | 2101            |
| 1         | 455         | 329             |
| 3         | 455         | -231            |
| 1         | 456         | 1314            |
| 2         | 456         | 744             |
| 3         | 456         | -55             |
| 4         | 456         | 12              |
| 1         | 457         | 195             |
| 2         | 457         | -234            |
| 3         | 457         | -714            |
| 4         | 457         | -718            |
| 1         | 458         | 715             |
| 2         | 458         | -653            |
| 1         | 459         | 246             |
| 2         | 459         | -2912           |
| 3         | 459         | -2834           |
| 1         | 460         | 80              |
| 2         | 460         | -1158           |
| 3         | 460         | -1175           |
| 4         | 460         | -327            |
| 1         | 461         | 2267            |
| 2         | 461         | 3431            |
| 3         | 461         | 3212            |
| 1         | 462         | 907             |
| 2         | 462         | -10             |
| 3         | 462         | -831            |
| 4         | 462         | -1395           |
| 1         | 463         | 1166            |
| 2         | 463         | 312             |
| 3         | 463         | 673             |
| 4         | 463         | 280             |
| 1         | 464         | 953             |
| 3         | 464         | -511            |
| 4         | 464         | -1494           |
| 1         | 465         | 955             |
| 2         | 465         | 1989            |
| 3         | 465         | 1506            |
| 4         | 465         | 1350            |
| 1         | 466         | 80              |
| 2         | 466         | -1979           |
| 3         | 466         | -2113           |
| 1         | 467         | 1994            |
| 2         | 467         | 3582            |
| 3         | 467         | 2754            |
| 4         | 467         | 1190            |
| 1         | 468         | 39              |
| 2         | 468         | -155            |
| 3         | 468         | -917            |
| 1         | 469         | 386             |
| 2         | 469         | 2161            |
| 3         | 469         | -802            |
| 4         | 469         | -1537           |
| 1         | 470         | 377             |
| 2         | 470         | -311            |
| 1         | 471         | 781             |
| 3         | 471         | 1238            |
| 4         | 471         | 1887            |
| 1         | 472         | 811             |
| 2         | 472         | -115            |
| 3         | 472         | 32              |
| 4         | 472         | 218             |
| 1         | 473         | -183            |
| 2         | 473         | -864            |
| 3         | 473         | -3630           |
| 4         | 473         | -5772           |
| 1         | 474         | 928             |
| 2         | 474         | 139             |
| 3         | 474         | -259            |
| 1         | 475         | -673            |
| 2         | 475         | -1966           |
| 3         | 475         | -5073           |
| 1         | 476         | -476            |
| 2         | 476         | -2003           |
| 3         | 476         | -3365           |
| 4         | 476         | -4972           |
| 1         | 477         | -3034           |
| 2         | 477         | -4592           |
| 3         | 477         | -6538           |
| 1         | 478         | -712            |
| 2         | 478         | 2278            |
| 3         | 478         | 2087            |
| 1         | 479         | 320             |
| 2         | 479         | -327            |
| 3         | 479         | 513             |
| 1         | 480         | 522             |
| 3         | 480         | -235            |
| 4         | 480         | -165            |
| 1         | 481         | -1396           |
| 2         | 481         | -2905           |
| 3         | 481         | -3394           |
| 1         | 482         | 386             |
| 2         | 482         | -687            |
| 3         | 482         | -1256           |
| 1         | 483         | 2038            |
| 3         | 483         | -189            |
| 4         | 483         | 1330            |
| 1         | 484         | 871             |
| 3         | 484         | 1796            |
| 1         | 485         | 16              |
| 2         | 485         | 1507            |
| 3         | 485         | 2202            |
| 1         | 486         | -1632           |
| 2         | 486         | -2250           |
| 3         | 486         | -3108           |
| 1         | 487         | -572            |
| 2         | 487         | 312             |
| 3         | 487         | 162             |
| 4         | 487         | -330            |
| 1         | 488         | -243            |
| 2         | 488         | 297             |
| 3         | 488         | -412            |
| 4         | 488         | -191            |
| 1         | 489         | 556             |
| 2         | 489         | 1808            |
| 3         | 489         | 3342            |
| 4         | 489         | 5338            |
| 1         | 490         | 271             |
| 2         | 490         | 342             |
| 4         | 490         | 24              |
| 1         | 491         | -3              |
| 2         | 491         | 298             |
| 3         | 491         | -2319           |
| 1         | 492         | -738            |
| 2         | 492         | -1399           |
| 3         | 492         | -2133           |
| 1         | 493         | 845             |
| 2         | 493         | -824            |
| 4         | 493         | -738            |
| 1         | 494         | 529             |
| 2         | 494         | 909             |
| 3         | 494         | 1447            |
| 1         | 495         | -286            |
| 2         | 495         | -1438           |
| 3         | 495         | -89             |
| 1         | 496         | 47              |
| 2         | 496         | -3076           |
| 3         | 496         | -2426           |
| 1         | 497         | 754             |
| 2         | 497         | 1003            |
| 3         | 497         | 1739            |
| 4         | 497         | 2680            |
| 1         | 498         | 1360            |
| 2         | 498         | 2195            |
| 3         | 498         | 2989            |
| 4         | 498         | 3488            |
| 1         | 499         | -304            |
| 2         | 499         | 1415            |
| 3         | 499         | 599             |
| 1         | 500         | 1594            |
| 2         | 500         | 2981            |
| 3         | 500         | 2251            |

*/


-- What is the percentage of customers who increase their closing balance by more than 5%?

WITH cte_closing_balance AS (
  SELECT 
    txn_month
    , customer_id
    , SUM(balance) OVER (PARTITION BY customer_id ORDER BY txn_month) AS closing_balance
  FROM(
    	SELECT  
    		EXTRACT(MONTH FROM txn_date) AS txn_month
        , customer_id
        , SUM(CASE WHEN txn_type = 'deposit' THEN txn_amount ELSE 0 END) - SUM(CASE WHEN txn_type = 'purchase' THEN txn_amount ELSE 0 END) - SUM(CASE WHEN txn_type = 'withdrawal' THEN txn_amount ELSE 0 END) AS "balance"
      FROM data_bank.customer_transactions
      GROUP BY EXTRACT(MONTH FROM txn_date), customer_id
        )b
  GROUP BY txn_month, customer_id, balance)
    
    
SELECT 
   (COUNT(DISTINCT CASE WHEN (closing_balance/CASE WHEN lag_balance=0 THEN closing_balance ELSE lag_balance END) > 1.05 THEN customer_id ELSE null END)*100)
   / COUNT(DISTINCT customer_id) AS percent_balance_greater5
FROM (
    SELECT 
      customer_id
      , closing_balance
      , LAG(closing_balance) OVER (PARTITION BY customer_id ORDER BY txn_month) AS lag_balance
    FROM cte_closing_balance
      )a;


-- Output
--| percent_balance_greater5 |
--| ------------------------ |
--| 75                       |





